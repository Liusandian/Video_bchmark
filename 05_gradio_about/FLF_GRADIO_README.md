# WAN 首尾帧视频生成器 (FLF2V) - Gradio Web 界面

基于 DiffSynth-Engine 的 WAN FLF2V 模型，通过首帧和尾帧自动生成流畅过渡视频的 Web 界面。

## 🌟 核心特性

- 🎯 **首尾帧驱动**：仅需提供首帧和尾帧，AI 自动生成中间过渡
- 🎬 **高质量输出**：支持最高 1280x720 高清分辨率
- 🇨🇳 **中文优化**：完全支持中文提示词和界面
- 📐 **多分辨率支持**：5种优化分辨率选项
- ⚙️ **精细参数控制**：CFG Scale、帧数、种子等可调节
- 📋 **智能模板**：预设多种应用场景模板

## 🚀 快速开始

### 1. 安装依赖

确保已安装 DiffSynth-Engine 和 Gradio：

```bash
pip install gradio
```

### 2. 运行应用

**方式一（推荐）：使用启动脚本**
```bash
python run_flf_gradio_app.py
```

**方式二：直接运行应用**
```bash
python examples/wan_flf_to_video_gradio.py
```

### 3. 访问界面

启动后，在浏览器中访问：`http://localhost:7862`

## 📸 使用流程

### 步骤 1：准备图像
- **首帧图像**：视频开始时的画面
- **尾帧图像**：视频结束时的画面
- **要求**：构图相似，主体位置接近

### 步骤 2：选择模板
从预设模板中选择或自定义：
- 小鸟飞翔
- 花朵绽放
- 人物转身
- 水墨渲染
- 城市变迁

### 步骤 3：描述过程
详细描述首尾帧之间的变化过程：
- 重点描述运动和变化
- 使用动词：绽放、飞翔、转动、流动
- 包含时间概念：逐渐、缓缓、慢慢

### 步骤 4：调整参数
- **分辨率**：选择适合的输出尺寸
- **帧数**：控制视频长度
- **CFG Scale**：调节提示词遵循程度
- **种子**：确保结果可重现

### 步骤 5：生成视频
点击"生成视频"按钮，等待 AI 处理

## 🎨 应用场景

### 1. 🐦 动物运动
**适用场景**：小鸟飞翔、鱼儿游动、蝴蝶飞舞
```
首帧：小鸟站在树枝上
尾帧：小鸟在空中展翅
提示词："小鸟煽动翅膀从树枝起飞，展翅高飞向蓝天"
```

### 2. 🌸 植物生长
**适用场景**：花朵绽放、树叶舒展、果实成熟
```
首帧：含苞待放的花蕾
尾帧：完全绽放的花朵
提示词："花蕾逐渐绽放，花瓣层层展开，露出美丽的花蕊"
```

### 3. 👤 人物动作
**适用场景**：表情变化、姿态转换、动作过渡
```
首帧：人物正面站立
尾帧：人物侧身转向
提示词："优雅的女性缓缓转身，长发飘逸，动作流畅自然"
```

### 4. 🌃 场景变化
**适用场景**：时间流逝、天气变化、光影效果
```
首帧：白天的城市街道
尾帧：夜晚的霓虹灯光
提示词："时间流逝，从白天过渡到夜晚，灯光逐渐点亮"
```

### 5. 🎨 艺术创作
**适用场景**：绘画过程、雕塑成型、书法展现
```
首帧：空白的画布
尾帧：完成的水墨画
提示词："水墨在纸上渲染，从空白逐渐形成山水画卷"
```

## ⚙️ 参数详解

### 分辨率选择

| 分辨率 | 比例 | 适用场景 | 显存需求 |
|--------|------|----------|----------|
| 1280x720 | 16:9 | 横屏高清，风景、动作 | 14-16GB |
| 960x960 | 1:1 | 方形构图，人像、特写 | 12-14GB |
| 720x1280 | 9:16 | 竖屏高清，手机观看 | 14-16GB |
| 832x480 | 16:9 | 横屏标准，快速预览 | 10-12GB |
| 480x832 | 9:16 | 竖屏标准，社交媒体 | 8-10GB |

### CFG Scale 调节

- **1.0-3.0**：创意性强，可能偏离提示词
- **3.5-5.5**：平衡创意和遵循度（推荐）
- **6.0-8.0**：严格遵循提示词
- **8.5-10.0**：可能过度拟合，影响自然度

### 帧数设置

- **25-49帧**：短视频（1.5-3秒），快速预览
- **65-81帧**：标准长度（4-5秒），推荐使用
- **97-121帧**：长视频（6-8秒），精细动作

## 💡 最佳实践

### 图像准备技巧

1. **构图一致性**
   - 保持相同的拍摄角度
   - 主体在画面中的位置相近
   - 背景环境基本一致

2. **清晰度要求**
   - 使用高质量图像
   - 避免模糊或噪点过多
   - 确保主体清晰可识别

3. **变化合理性**
   - 首尾帧之间的变化要合理
   - 避免过于剧烈的场景切换
   - 考虑物理规律和运动轨迹

### 提示词优化

1. **动作描述**
   ```
   ❌ "一只鸟和天空"
   ✅ "小鸟煽动翅膀从地面起飞，展翅飞向蓝天"
   ```

2. **过程细节**
   ```
   ❌ "花开了"
   ✅ "花蕾逐渐绽放，花瓣层层舒展，露出娇嫩的花蕊"
   ```

3. **时间流逝**
   ```
   ❌ "白天和黑夜"
   ✅ "时间缓缓流逝，从午后阳光过渡到夜晚星空"
   ```

## 🔧 系统要求

### 硬件配置

| 配置等级 | GPU | 显存 | 内存 | 生成时间 |
|----------|-----|------|------|----------|
| 最低配置 | RTX 3060 | 8GB | 16GB | 15-25分钟 |
| 推荐配置 | RTX 4070 | 12GB | 32GB | 8-12分钟 |
| 高端配置 | RTX 4090 | 24GB | 32GB+ | 5-8分钟 |

### 软件环境

- **操作系统**：Windows 10/11, Linux (Ubuntu 18.04+)
- **Python**：3.8-3.11
- **CUDA**：11.8 或 12.x
- **PyTorch**：2.0+

### 存储需求

- **模型文件**：约 15GB
- **临时文件**：每个视频约 100-500MB
- **建议可用空间**：至少 25GB

## 📁 项目结构

```
DiffSynth-Engine-main/
├── examples/
│   ├── wan_flf_to_video_gradio.py       # 主应用文件
│   ├── wan_flf_to_video.py              # 原始命令行版本
│   ├── wan_flf2v_input_first_frame.png  # 示例首帧
│   └── wan_flf2v_input_last_frame.png   # 示例尾帧
├── run_flf_gradio_app.py                # 启动脚本
└── FLF_GRADIO_README.md                 # 本说明文档
```

## 🐛 常见问题

### Q1: 显存不足 "CUDA out of memory"

**解决方案**：
1. 降低分辨率（选择较小的分辨率选项）
2. 减少帧数（改为 49 或 65 帧）
3. 关闭其他占用显存的程序
4. 重启应用释放显存

### Q2: 生成的视频不自然

**可能原因及解决方案**：
1. **首尾帧差异过大**
   - 选择变化更渐进的首尾帧
   - 确保主体位置和姿态相近

2. **提示词不够详细**
   - 增加动作和过程的描述
   - 使用更多动词和时间副词

3. **CFG Scale 不当**
   - 尝试调整到 4.0-6.0 范围
   - 避免过高或过低的值

### Q3: 模型下载失败

**解决方案**：
1. 检查网络连接稳定性
2. 配置代理或使用国内镜像
3. 手动下载模型文件：
   ```bash
   # 示例：手动下载命令
   huggingface-cli download muse/wan2.1-flf2v-14b-720p-bf16
   ```

### Q4: 生成时间过长

**优化建议**：
1. 确认使用 GPU 而非 CPU
2. 选择较小的分辨率和帧数
3. 检查系统资源使用情况
4. 考虑升级硬件配置

### Q5: 视频质量不理想

**改进方法**：
1. 使用高质量的输入图像
2. 优化提示词描述
3. 尝试不同的随机种子
4. 调整 CFG Scale 参数

## 🔄 与其他版本的对比

| 版本 | 输入方式 | 主要特点 | 适用场景 |
|------|----------|----------|----------|
| **图像到视频** | 单张图像 + 提示词 | 简单易用，基础动画 | 静态图像动化 |
| **文本到视频** | 仅提示词 | 纯创意生成 | 从零创作视频 |
| **LoRA 文生视频** | 提示词 + 风格 | 特定艺术风格 | 风格化视频创作 |
| **首尾帧生成** | 首尾帧 + 提示词 | 精确控制过渡 | 专业动画制作 |

## 🎯 进阶技巧

### 1. 批量处理
```python
# 可以修改代码支持批量处理多组首尾帧
# 适合制作系列动画或连续场景
```

### 2. 风格一致性
```python
# 使用相同的种子和参数确保多个视频风格一致
# 适合制作连贯的视频系列
```

### 3. 动作细分
```python
# 将复杂动作分解为多个简单的首尾帧对
# 然后拼接成完整的长视频
```

## 📄 许可证

遵循 DiffSynth-Engine 项目的许可证要求。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request：
- 🐛 Bug 报告和修复
- ✨ 新功能建议
- 📚 文档改进
- 🎨 UI/UX 优化
- 🚀 性能提升

## 🔗 相关链接

- [DiffSynth-Engine 官方仓库](https://github.com/modelscope/DiffSynth-Studio)
- [WAN 模型介绍](https://arxiv.org/abs/2402.01741)
- [Gradio 官方文档](https://gradio.app/docs/)

---

**享受创作的乐趣！通过首尾帧生成，让静态图像焕发动态生命力！** 🎬✨ 