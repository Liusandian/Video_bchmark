# WAN LoRA 文生视频生成器 - Gradio Web 界面

基于 DiffSynth-Engine 的 WAN 模型，支持 LoRA 风格迁移的纯文本到视频生成 Web 界面。

## 🌟 特色功能

- 🎨 **LoRA 艺术风格**：支持多种艺术风格模型
- 📝 **纯文本生成**：无需输入图像，仅通过文字描述生成视频
- 🇨🇳 **中文友好**：完全支持中文提示词
- ⚙️ **灵活参数**：可调节 LoRA 权重和各种生成参数
- 📋 **模板系统**：预设多种提示词模板
- 🎬 **竖屏优化**：默认 480x832 竖屏比例

## 🚀 快速开始

### 1. 安装依赖

确保已安装 DiffSynth-Engine 和 Gradio：

```bash
pip install gradio
```

### 2. 运行应用

**方式一（推荐）：使用启动脚本**
```bash
python run_lora_gradio_app.py
```

**方式二：直接运行应用**
```bash
python examples/wan_lora_text_to_video_gradio.py
```

### 3. 访问界面

启动后，在浏览器中访问：`http://localhost:7861`

## 🎨 LoRA 模型说明

### 当前支持的 LoRA 模型

- **WAN Silver Style** (`VoidOc/wan_silver`)：
  - 银色艺术风格
  - 适合人像和唯美场景
  - 触发词：`wan_silver`
  - 推荐权重：0.8-1.2

### LoRA 权重调节

- **0.0**：完全不使用 LoRA，原始模型效果
- **0.5-0.8**：轻微风格化，保留更多原始特征
- **1.0**：标准强度，平衡风格化和质量
- **1.2-2.0**：强风格化，可能影响细节质量

## 📝 提示词编写指南

### 中文提示词模板

```
角色描述 + 场景设置 + 动作描述 + 光影效果 + 构图视角 + 风格关键词
```

### 示例模板解析

**樱花女性模板**：
```
一张亚洲女性在水中被樱花环绕的照片。                    # 主体描述
她拥有白皙的肌肤和精致的面容，樱花散落在她的脸颊，      # 细节描述
她轻盈地漂浮在水中。                                    # 动作状态
阳光透过水面洒下，形成斑驳的光影，                      # 光影效果
营造出一种宁静而超凡脱俗的氛围。                        # 情感氛围
中景脸部人像特写，俯视视角。                            # 构图视角
,wan_silver,wan_silver                                  # LoRA 触发词
```

### 提示词优化技巧

1. **主体明确**：清楚描述主要角色或物体
2. **场景丰富**：详细描述环境和背景
3. **动作具体**：描述具体的动作和状态变化
4. **光影描述**：加入光线、阴影、氛围描述
5. **视角构图**：指定拍摄角度和构图方式
6. **风格关键词**：添加 LoRA 相关的触发词

## ⚙️ 参数设置指南

### 视频参数

| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 帧数 | 81 | 约5秒视频，平衡质量和生成时间 |
| 宽度 | 480 | 适合大多数场景 |
| 高度 | 832 | 竖屏比例，适合手机观看 |
| 种子 | 42 | 固定种子确保结果可重现 |

### 分辨率建议

- **480x832**：竖屏标准，推荐用于人像
- **832x480**：横屏标准，适合风景
- **512x512**：方形，适合特殊构图
- **更高分辨率**：质量更好但生成时间大幅增加

### 帧数选择

- **25-49帧**：短视频，快速预览
- **65-81帧**：标准长度，推荐使用
- **97-121帧**：长视频，高质量但耗时

## 🎯 使用场景示例

### 1. 人像视频生成

```
提示词: "一位优雅的东方女性，身穿传统汉服，在古典庭院中缓缓走过。她的长发轻柔飘动，眼神温婉如水，阳光透过梧桐叶洒在她的脸上，营造出诗意般的美感。背景是古色古香的建筑和盛开的牡丹花。近景人物特写，平视角度。,wan_silver"

LoRA: WAN Silver Style (权重 1.0)
分辨率: 480x832
帧数: 81
```

### 2. 自然风光视频

```
提示词: "壮观的山水画卷，高山流水，云雾缭绕。瀑布从峭壁上飞流直下，激起层层水雾，彩虹若隐若现。青山绿水间，小鸟翱翔，花瓣随风飘洒，展现大自然的绝美风光。远景全景拍摄，略微俯视。"

LoRA: 无 LoRA 或 WAN Silver Style (权重 0.6)
分辨率: 832x480
帧数: 81
```

### 3. 城市夜景视频

```
提示词: "繁华都市的夜晚，摩天大楼林立，霓虹灯光璀璨夺目。车流如织，光影交错，展现现代都市的活力与魅力。街道上人来人往，商店招牌闪烁，营造出充满活力的都市夜生活氛围。中景街景，平视角度。"

LoRA: 无 LoRA
分辨率: 832x480
帧数: 65
```

## 🔧 系统要求

### 硬件要求

- **GPU**：NVIDIA RTX 3060 或更高（推荐 RTX 4070+）
- **显存**：8GB+（推荐 12GB+）
- **内存**：16GB+（推荐 32GB）
- **存储空间**：至少 20GB 可用空间

### 软件环境

- **Python**：3.8-3.11
- **CUDA**：11.8 或 12.x
- **PyTorch**：2.0+
- **操作系统**：Windows 10/11, Linux

### 性能参考

| 配置 | 生成时间 (81帧) | 显存占用 |
|------|----------------|----------|
| RTX 4090 | 3-5分钟 | 10-12GB |
| RTX 4070 | 6-8分钟 | 8-10GB |
| RTX 3060 | 10-15分钟 | 6-8GB |

## 📁 项目文件

- `examples/wan_lora_text_to_video_gradio.py`：主要的 Gradio 应用
- `run_lora_gradio_app.py`：启动脚本
- `examples/wan_lora.py`：原始命令行版本
- `LORA_GRADIO_README.md`：本说明文档

## 🐛 常见问题

### Q1: 提示 "CUDA 内存不足"

**解决方案**：
- 降低分辨率（如改为 384x640）
- 减少帧数（如改为 49 帧）
- 关闭其他占用显存的程序
- 重启应用释放显存

### Q2: 生成的视频质量不佳

**解决方案**：
- 优化提示词，增加细节描述
- 调整 LoRA 权重（尝试 0.8-1.2）
- 使用更合适的分辨率比例
- 检查负面提示词设置

### Q3: LoRA 效果不明显

**解决方案**：
- 确保提示词中包含触发词（如 "wan_silver"）
- 适当提高 LoRA 权重
- 检查选择的 LoRA 模型是否适合当前场景

### Q4: 模型下载失败

**解决方案**：
- 检查网络连接
- 配置代理或使用国内镜像
- 手动下载模型文件到对应目录

### Q5: 生成速度很慢

**解决方案**：
- 确认正在使用 GPU 而非 CPU
- 检查显存是否充足
- 考虑降低生成参数

## 🎨 扩展 LoRA 模型

### 添加新 LoRA 模型

1. 在 `LORA_OPTIONS` 字典中添加新模型
2. 在 `load_lora_model` 函数中添加对应的加载逻辑
3. 更新提示词模板和说明文档

```python
LORA_OPTIONS = {
    "无 LoRA": None,
    "WAN Silver Style": "VoidOc/wan_silver",
    "新风格模型": "your_model_path",  # 添加新模型
}
```

### 自定义 LoRA 训练

参考 DiffSynth-Engine 的 LoRA 训练文档，使用自己的数据集训练专属风格模型。

## 📄 许可证

遵循 DiffSynth-Engine 项目的许可证要求。

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目：
- Bug 报告
- 新功能建议
- 文档改进
- 新 LoRA 模型推荐 